<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <title th:text="'Netflix - ' + ${movie.title}">Netflix - Watch</title>
    <link rel="stylesheet" href="/css/netflix.css">
</head>
<body class="watch-body">
    <nav class="watch-nav">
        <div class="nav-left">
            <h1>NETFLIX</h1>
            <a href="/dashboard" class="back-btn">← Back</a>
        </div>
        <div class="nav-right">
            <span sec:authentication="name"></span>
            <a href="/logout">Sign Out</a>
        </div>
    </nav>
    
    <div class="watch-container">
        <div class="video-player">
            <div class="video-wrapper" th:if="${movie.trailerUrl}">
                <iframe th:src="${movie.trailerUrl}" 
                        frameborder="0" 
                        allowfullscreen
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture">
                </iframe>
            </div>
            <div th:unless="${movie.trailerUrl}" class="video-placeholder">
                <div class="play-icon">▶</div>
                <p>No trailer available</p>
                <p th:text="'Playing: ' + ${movie.title}"></p>
            </div>
        </div>
        
        <div class="movie-details">
            <div class="movie-header">
                <img th:src="${movie.imageUrl}" th:alt="${movie.title}" class="movie-poster">
                <div class="movie-info">
                    <h1 th:text="${movie.title}"></h1>
                    <div class="movie-meta">
                        <span th:text="${movie.releaseYear}"></span>
                        <span th:text="${movie.duration} + ' min'"></span>
                        <span th:text="${movie.genre}"></span>
                        <span class="rating" th:text="'★ ' + ${movie.ratingAvg ?: 'N/A'}"></span>
                    </div>
                    <div class="movie-actions">
                        <button class="btn-play" onclick="playMovie()">▶ Play</button>
                        <button class="btn-rate" onclick="rateMovie()">★ Rate</button>
                    </div>
                </div>
            </div>
            
            <div class="movie-description">
                <h3>About this <span th:text="${movie.contentType}"></span></h3>
                <p>Experience the ultimate entertainment with this amazing <span th:text="${movie.genre}"></span> <span th:text="${movie.contentType}"></span>. 
                Released in <span th:text="${movie.releaseYear}"></span>, this captivating story will keep you engaged for <span th:text="${movie.duration}"></span> minutes.</p>
            </div>
        </div>
    </div>
    
    <script th:inline="javascript">
        const movieId = [[${movie.movieId}]];
        
        function playMovie() {
            alert('Playing ' + [[${movie.title}]] + '...\n\nIn a real Netflix app, this would start the video player.');
        }
        
        function rateMovie() {
            const rating = prompt('Rate this movie (1-5 stars):');
            if (rating && rating >= 1 && rating <= 5) {
                fetch(`/api/watch/${movieId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: `rating=${rating}`
                })
                .then(response => response.text())
                .then(data => {
                    alert(data);
                    location.reload();
                })
                .catch(error => alert('Error: ' + error));
            }
        }
        

    </script>
</body>
</html>